# Лабораторная работа "Дополнительные возможности в механизме привязки данных в Windows Presentation Foundation" 

## Сплайны в библиотеке Intel MKL

В лабораторной работе надо создать пользовательский  интерфейс приложения  для аппроксимации  данных  измерений  с  помощью  одномерного  интерполяционного кубического  сплайна,  вычисленного  с  помощью  математической  библиотеки  **Intel MKL,**  пересчета  данных  измерений  на  другую  сетку,  представления  результатов аппроксимации в графическом виде и вычисления интеграла от аппроксимирующего сплайна по заданному отрезку. 

В среде VisualStudio надо cоздать решение (solution) с тремя проектами: 

- тип одного проекта – **библиотека классов (class library) C#**, в которой находятся типы **MeasuredData, SplineParameters, SplinesData;** 
- тип второго проекта – **Dll-библиотека C++;** 
- тип третьего проекта – приложение **Windows Presentation Foundation (WPF).** 

## Dll−библиотека C++

В Dll−библиотеке **C++** находится глобальная функция, которая вызывается из кода **C#** с использованием  механизма  **PInvoke.**  Из  этой  глобальной  функции  вызываются функции из библиотеки **Intel MKL**. 

Из  кода  **C#**  через  параметры  глобальной  функции  передаются  данные,  которые необходимы для вычисления сплайнов. Через параметры глобальной функции в код **C#** возвращаются результаты и код ошибки. 

## Библиотека классов C#*

Библиотека классов C# содержит следующие типы. 

**Перечисление**  (**enum**)  **SPf**  с  элементами,  отвечающим  функциям,  которые используются  для  вычисления  данных.  Вычисленные  значения  будут  играть  роль измеренных  данных.  Среди  функций,  которые  можно  вызвать  для  вычислений, должны быть 

- линейная функция; 
- кубический многочлен; 
- функция,  которая  вычисляет  “измеренные”  значения  с  помощью  генератора псевдослучайных чисел **Random**. 

Класс **MeasuredData**, в котором** определены открытые  

- свойство типа **int** для числа узлов неравномерной сетки; 
- два свойства типа **double** (или одно свойство типа **double[])** для концов отрезка **[a,b].** 
- свойство типа **SPf;** 
- свойство типа **double[]** для массива узлов неравномерной сетки (только с методом get); 
- свойство типа **double[]** для массива “измеренных” значений в узлах неравномерной сетки; 
- конструктор и методы,** в которых вычисляются узлы неравномерной сетки на отрезке **[a,b]**; концы отрезка **a,b** должны быть узлами сетки; координаты узлов надо вычислить с помощью класса **Random**. 

Класс **SplineParameters**, в котором определены открытые  

- свойство типа **int** для числа узлов равномерной сетки; границы отрезка **[a,b]** для равномерной сетки такие же, как и у неравномерной сетки; концы отрезка **a** и **b** должны быть узлами равномерной сетки;  
- два свойства типа **double** (или одно свойство типа **double[])** для значений первой производной сплайна на концах отрезка **[a,b]**. 
- два свойства типа **double** (или одно свойство типа **double[])** для границ отрезка, по которому вычисляется интеграл. 

**Класс** **SplinesData** содержит открытые 

- конструктор **SplinesData (MeasuredData md, SplineParameters sp)**; 
- свойства типа **MeasuredData** и **SplineParameters**; 
- можно определить дополнительные свойства только с методами **get** для доступа к свойствам объектов **MeasuredData** и **SplineParameters**;  
- метод для построения сплайна и вычисления интеграла, в котором вызываются методы из библиотеки **Intel MKL**; 
- свойство типа **double[]** для массива значений кубического сплайна на равномерной сетке; 
- свойство типа **double** для значения интеграла. 

В  классе  **SplinesData**  можно  определить  свойство  типа  **double[]**  для  массива  узлов равномерной  сетки  (только  с  методом  get);  это  свойство  можно  использовать  при построении графики. 

## Класс ViewData

В проекте **WPF** надо определить класс **ChartData** для данных для построения графики и класс **ViewData,** который содержит свойства и методы для обмена данными между пользовательским  интерфейсом  и  данными  классов  **MeasuredData**  и  **SplinesData.** Объект  типа  **ViewData**  является  полем  (или  свойством)  в  классе  главного  окна приложения  **WPF**.  Все  операции  приложения  с  данными  происходят  через  вызовы методов или свойств класса **ViewData.** 

Класс **ViewData** содержит открытые 

- свойство типа **SplineParameters** для параметров сплайна; 
- свойство типа **SplinesData**; 
- свойство типа **ChartData** (класс для данных графики). 

## Пользовательский интерфейс программы

### Элементы управления для ввода данных. Проверка корректности данных в привязке.

Главное  окно  приложения  содержит  следующие  элементы  управления,  в  которые пользователь вводит данные для **MeasuredData** и **SplineParameters:** 

- **ComboBox** для выбора функции, которая вычисляет “измеренные” данные; 
- элементы **ТехтBox** для ввода значений свойств **MeasuredData** ─ концов отрезка и числа узлов неравномерной сетки; можно предусмотреть свой элемент управления **ТехтBox** для каждого свойства или вводить в один элемент управления несколько значений c использованием преобразователя типа; 
- один или несколько элементов **ТехтBox** для ввода** значений свойств **SplineParameters** ─ числа узлов неравномерной сетки, граничных значений первой производной для сплайна;  
- один (или два) элемента **ТехтBox** для ввода** границ отрезка **[x1,x2]**, по которому вычисляется интеграл.  

Элементы управления для ввода информации должны быть подписаны – в главном окне приложения должна быть информация, для ввода каких данных предназначены элементы **ТехтBox**.  

Свойства элементов управления **ТехтBox** надо связать с соответствующими свойствами класса **ViewData** с помощью механизма привязки и в привязке проверять корректность введенных данных с использованием интерфейса **IDataErrorInfo**.  

Реализация интерфейса **IDataErrorInfo** должна проверять, что  

- число узлов неравномерной сетки больше 2; 
- число узлов равномерной сетки больше 2; 
- левый конец отрезка интерполяции **[a,b]** меньше, чем правый конец отрезка; 
- для  концов  отрезка,  по  которому  вычисляется  интеграл,  выполнено **a <= x1 < x2 <= b.** 

### Элементы управления для вывода данных.

Главное окно приложения содержит следующие элементы для вывода информации:

- **ListBox** для вывода информации из **MeasuredData**;  
- **ListBox**  (или **TextBlock** ) для вывода информации из **SplinesData**. 

Для  **MeasuredData**  для  каждого  узла  неравномерной  сетки  в  элемент  управления **ListBox** выводятся значение координаты узла и “измеренное” значение в узле. 

Для **SplinesData** в элемент управления **ListBox**  (или **TextBlock** ) выводятся заданные значения первой производной на концах отрезка **a** и **b**, значения сплайна, первой производной на концах отрезка **a** и **b** и значение интеграла, вычисленные в методе сплайн-аппроксимации из **Intel MKL.** 

В классе **ViewData** можно определить свойства для того, чтобы использовать их как источник  данных  в  привязке  к  элементам  управления  **ListBox**  (или  **TextBlock)**  для вывода  информации  о  сплайне  и  **MeasuredData**.  В  случае,  когда  используются элементы  управления  **ListBox,**  можно  определить  свойство  типа **ObservableCollection<string>.** 

### Элементы управления для вывода данных в графическом виде

Главное  окно  приложения  содержит  элемент  управления  для  представления  в графическом  виде  измеренных  данных  и  результата  сплайн-аппроксимации.** “Измеренные  значения”**  выводятся  с  помощью  маркеров.  Результаты  сплайн- аппроксимации  (значения  сплайна  на  равномерной  сетке)  изображаются  в  виде линии.  

На  графике  должны  быть  оцифрованные  оси,  при  оцифровке  осей  должно  быть выведено небольшое число знаков после запятой.  

Графики надо подписать в легенде.   

Можно использовать элементы управления для вывода графики из пакета **OxyPlot** из репозитария  платформы  управления  пакетами  **NuGet**,  элемент  **CartesianChart**  из пакета **LiveCharts** **NuGet** или  любой другой элемент для графики. Если приложение скомпилировано  для  платформы  **NetFramework**,  для  вывода  графики  можно использовать элемент управления **Chart** из **WindowsForm**.  

### Команды

Главное окно приложения содержит меню с элементами 

- **MeasuredData**; 
- **Splines**. 

и кнопки **MeasuredData** и **Splines** (или элемент управления **ToolBar** с кнопками).  

Надо  определить  пользовательскую  команду  и  связать  ее  с  элементом  меню **MeasuredData** и соответствующей кнопкой.  

- Обработчик события **CanExecute** команды должен проверить, что введенные пользователем параметры неравномерной сетки для **MeasuredData** не содержат ошибок. Корректность данных проверяется в привязках элементов управления к свойствам, которые контролируется в **IDataErrorInfo.** 
- Обработчик события **Execute** команды выводит данные из **MeasuredData** в элемент управления **ListBox** и представляет их в графическом виде.  

Для элемента меню и кнопки **Splines** надо определить пользовательскую команду и связать ее с элементом меню и кнопкой.  

- Обработчик события **CanExecute** команды должен проверить, что уже создан объект **MeasuredData,** и что введенное пользователем число узлов равномерной сетки и границы отрезка интегрирования имеют корректные значения. Корректность проверяется в привязке к свойствам, которые контролируются в **IDataErrorInfo.** 
- Обработчик события **Execute** команды вызывает метод для вычисления сплайна и интеграла, выводит данные из **SplinesData** в элемент управления **ListBox** (или **TextBlock**) и представляет их в графическом виде.  

## Обработка исключений

Все  исключения,  которые  могут  возникать  при  обработке  некорректного  ввода пользователя, должны обрабатываться приложением. Приложение должно оставаться в  рабочем  состоянии  до  тех  пор,  пока  пользователь  не  закроет  главное  окно приложения. 
